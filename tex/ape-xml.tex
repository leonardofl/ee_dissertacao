%% ------------------------------------------------------------------------- %%
\chapter{Representação XML da Linguagem de Descrição Arquitetural do \ee}
\label{ape:xml}

Neste apêndice nós fornecemos um exemplo de especificação de coreografia (Listagem~\ref{lst:chor_spec_xml}) em formato XML para o exemplo da coreografia envolvendo o serviço de Agência de Viagens que depende do serviço da Companhia Aérea. Logo em seguida, a Listagem~\ref{lst:chor_xml} mostra um exemplo de resposta do \ee\ para a requisição anterior, contendo informação sobre as localizações dos serviços implantados. Representações em XML para quaisquer especificações de coreografias podem ser produzidas ao se observar o \emph{schema} definido na Listagem~\ref{lst:xsd}.

\lstset{language=XML}

{\footnotesize
\begin{lstlisting}[frame=trbl, label=lst:chor_spec_xml, caption=Exemplo de representação XML da classe \textsf{ChorSpec}]

<chorSpec>

  <serviceSpecs>
    <codeUri>http://valinhos.ime.usp.br:54080/enact_test/airline-service.jar</codeUri>
     <endpointName>airline</endpointName>
     <name>airline</name>
     <port>1234</port>
     <type>COMMAND_LINE</type>
     <roles>airline</roles>
  </serviceSpecs>
  
  <serviceSpecs>
    <codeUri>http://valinhos.ime.usp.br:54080/enact_test/travel-agency-service.jar</codeUri>
    <endpointName>travelagency</endpointName>
    <name>travelagency</name>
    <port>1235</port>
    <type>COMMAND_LINE</type>
    <dependences>
      <serviceName>airline</serviceName>
      <serviceRole>airline</serviceRole>
    </dependences>
    <roles>travelagency</roles>
  </serviceSpecs>
  
</chorSpec>
\end{lstlisting}
}

{\footnotesize
\begin{lstlisting}[frame=trbl, label=lst:chor_xml, caption=Exemplo de representação XML da classe \textsf{Choreography}]
<choreography>

  <id>1</id>

  <chorSpec>
    <serviceSpecs>
      <codeUri>http://valinhos.ime.usp.br:54080/enact_test/airline-service.jar</codeUri>
      <endpointName>airline</endpointName>
      <name>airline</name>
      <port>1234</port>
      <type>COMMAND_LINE</type>
      <roles>airline</roles>
    </serviceSpecs>
    <serviceSpecs>
      <codeUri>http://valinhos.ime.usp.br:54080/enact_test/travel-agency-service.jar</codeUri>
      <endpointName>travelagency</endpointName>
      <name>travelagency</name>
      <port>1235</port>
      <type>COMMAND_LINE</type>
      <dependences>
        <serviceName>airline</serviceName>
        <serviceRole>airline</serviceRole>
      </dependences>
      <roles>travelagency</roles>
    </serviceSpecs>
  </chorSpec>
  
  <deployedServices>
    <host>choreos-node1</host>
     <ip>192.168.56.101</ip>
     <name>airline</name>
     <nodeId>choreos-node1</nodeId>
     <spec xsi:type="chorServiceSpec" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
       <codeUri>http://valinhos.ime.usp.br:54080/enact_test/airline-service.jar</codeUri>
       <endpointName>airline</endpointName>
       <name>airline</name>
       <port>1234</port>
       <type>COMMAND_LINE</type>
       <roles>airline</roles>
     </spec>
     <uri>http://192.168.56.101:1234/airline/</uri>
  </deployedServices>
  
  <deployedServices>
     <host>choreos-node2</host>
      <ip>192.168.56.102</ip>
      <name>travelagency</name>
      <nodeId>choreos-node2</nodeId>
      <spec xsi:type="chorServiceSpec" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
       <codeUri>http://valinhos.ime.usp.br:54080/enact_test/travel-agency-service.jar</codeUri>
        <endpointName>travelagency</endpointName>
        <name>travelagency</name>
        <port>1235</port>
        <type>COMMAND_LINE</type>
        <dependences>
           <serviceName>airline</serviceName>
           <serviceRole>airline</serviceRole>
        </dependences>
        <roles>travelagency</roles>
      </spec>
      <uri>http://192.168.56.102:1235/travelagency/</uri>
  </deployedServices>

</choreography>

\end{lstlisting}

}

{\footnotesize
\begin{lstlisting}[frame=trbl, label=lst:xsd, caption=\emph{Schema} em formato XSD da Linguagem de Descrição Arquitetural utilizada no \ee] 
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema version="1.0" xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="chorSpec" type="chorSpec"/>
    <xs:element name="choreography" type="choreography"/>
    <xs:element name="resourceImpact" type="resourceImpact"/>
    <xs:element name="service" type="service"/>
    <xs:element name="serviceSpec" type="serviceSpec"/>
    <xs:complexType name="choreography">
        <xs:sequence>
            <xs:element minOccurs="0" ref="chorSpec"/>
            <xs:element maxOccurs="unbounded" minOccurs="0"
                name="deployedServices" nillable="true" type="service"/>
            <xs:element minOccurs="0" name="id" type="xs:string"/>
        </xs:sequence>
    </xs:complexType>
    <xs:complexType name="chorSpec">
        <xs:sequence>
            <xs:element maxOccurs="unbounded" minOccurs="0"
                name="serviceSpecs" nillable="true" type="chorServiceSpec"/>
        </xs:sequence>
    </xs:complexType>
    <xs:complexType name="chorServiceSpec">
        <xs:complexContent>
            <xs:extension base="serviceSpec">
                <xs:sequence>
                    <xs:element maxOccurs="unbounded" minOccurs="0"
                        name="dependences" nillable="true" type="serviceDependence"/>
                    <xs:element minOccurs="0" name="group" type="xs:string"/>
                    <xs:element minOccurs="0" name="owner" type="xs:string"/>
                    <xs:element maxOccurs="unbounded" minOccurs="0"
                        name="roles" nillable="true" type="xs:string"/>
                </xs:sequence>
            </xs:extension>
        </xs:complexContent>
    </xs:complexType>
    <xs:complexType name="serviceSpec">
        <xs:sequence>
            <xs:element minOccurs="0" name="codeUri" type="xs:string"/>
            <xs:element minOccurs="0" name="endpointName" type="xs:string"/>
            <xs:element minOccurs="0" name="name" type="xs:string"/>
            <xs:element name="port" type="xs:int"/>
            <xs:element minOccurs="0" ref="resourceImpact"/>
            <xs:element minOccurs="0" name="type" type="serviceType"/>
        </xs:sequence>
    </xs:complexType>
    <xs:complexType name="serviceDependence">
        <xs:sequence>
            <xs:element minOccurs="0" name="serviceName" type="xs:string"/>
            <xs:element minOccurs="0" name="serviceRole" type="xs:string"/>
        </xs:sequence>
    </xs:complexType>
    <xs:complexType name="resourceImpact">
        <xs:sequence>
            <xs:element minOccurs="0" name="memory" type="xs:string"/>
            <xs:element minOccurs="0" name="cpu" type="xs:string"/>
            <xs:element minOccurs="0" name="io" type="xs:string"/>
            <xs:element minOccurs="0" name="region" type="xs:string"/>
        </xs:sequence>
    </xs:complexType>
    <xs:complexType name="service">
        <xs:sequence>
            <xs:element minOccurs="0" name="host" type="xs:string"/>
            <xs:element minOccurs="0" name="ip" type="xs:string"/>
            <xs:element minOccurs="0" name="name" type="xs:string"/>
            <xs:element minOccurs="0" name="nodeId" type="xs:string"/>
            <xs:element minOccurs="0" name="spec" type="serviceSpec"/>
            <xs:element minOccurs="0" name="uri" type="xs:string"/>
        </xs:sequence>
    </xs:complexType>
    <xs:simpleType name="serviceType">
        <xs:restriction base="xs:string">
            <xs:enumeration value="COMMAND_LINE"/>
            <xs:enumeration value="TOMCAT"/>
            <xs:enumeration value="EASY_ESB"/>
            <xs:enumeration value="LEGACY"/>
            <xs:enumeration value="OTHER"/>
        </xs:restriction>
    </xs:simpleType>
</xs:schema>

\end{lstlisting}

